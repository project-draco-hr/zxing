{
  StringBuilder historyText=new StringBuilder(1000);
  SQLiteOpenHelper helper=new DBHelper(activity);
  SQLiteDatabase db;
  try {
    db=helper.getWritableDatabase();
  }
 catch (  SQLiteException sqle) {
    Log.w(TAG,"Error while opening database",sqle);
    return "";
  }
  Cursor cursor=null;
  try {
    cursor=db.query(DBHelper.TABLE_NAME,EXPORT_COL_PROJECTION,null,null,null,null,DBHelper.TIMESTAMP_COL + " DESC");
    while (cursor.moveToNext()) {
      for (int col=0; col < EXPORT_COL_PROJECTION.length; col++) {
        historyText.append('"').append(massageHistoryField(cursor.getString(col))).append("\",");
      }
      long timestamp=cursor.getLong(EXPORT_COL_PROJECTION.length - 1);
      historyText.append('"').append(massageHistoryField(EXPORT_DATE_TIME_FORMAT.format(new Date(timestamp)))).append("\"\r\n");
    }
  }
  finally {
    if (cursor != null) {
      cursor.close();
    }
    db.close();
  }
  return historyText;
}
