{
  if (!activity.getIntent().getBooleanExtra(Intents.Scan.SAVE_HISTORY,true)) {
    return;
  }
  SharedPreferences prefs=PreferenceManager.getDefaultSharedPreferences(activity);
  boolean rememberDuplicates=prefs.getBoolean(PreferencesActivity.KEY_REMEMBER_DUPLICATES,false);
  if (!rememberDuplicates) {
    deletePrevious(result.getText());
  }
  SQLiteOpenHelper helper=new DBHelper(activity);
  SQLiteDatabase db=helper.getWritableDatabase();
  try {
    ContentValues values=new ContentValues();
    values.put(DBHelper.TEXT_COL,result.getText());
    values.put(DBHelper.FORMAT_COL,result.getBarcodeFormat().toString());
    values.put(DBHelper.DISPLAY_COL,result.getText());
    values.put(DBHelper.TIMESTAMP_COL,System.currentTimeMillis());
    db.insert(DBHelper.TABLE_NAME,DBHelper.TIMESTAMP_COL,values);
  }
  finally {
    db.close();
  }
}
