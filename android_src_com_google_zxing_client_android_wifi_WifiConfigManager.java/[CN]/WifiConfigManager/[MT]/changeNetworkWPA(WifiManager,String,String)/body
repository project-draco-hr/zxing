{
  WifiConfiguration config=changeNetworkCommon(ssid);
  if (HEX_DIGITS_64.matcher(password).matches()) {
    config.preSharedKey=password;
  }
 else {
    config.preSharedKey=convertToQuotedString(password);
  }
  config.allowedAuthAlgorithms.set(WifiConfiguration.AuthAlgorithm.OPEN);
  config.allowedProtocols.set(WifiConfiguration.Protocol.WPA);
  config.allowedKeyManagement.set(WifiConfiguration.KeyMgmt.WPA_PSK);
  config.allowedPairwiseCiphers.set(WifiConfiguration.PairwiseCipher.TKIP);
  config.allowedPairwiseCiphers.set(WifiConfiguration.PairwiseCipher.CCMP);
  config.allowedGroupCiphers.set(WifiConfiguration.GroupCipher.TKIP);
  config.allowedGroupCiphers.set(WifiConfiguration.GroupCipher.CCMP);
  config.allowedProtocols.set(WifiConfiguration.Protocol.RSN);
  updateNetwork(wifiManager,config);
}
