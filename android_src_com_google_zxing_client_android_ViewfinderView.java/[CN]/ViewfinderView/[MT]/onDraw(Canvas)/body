{
  Rect frame=CameraManager.get().getFramingRect();
  if (frame == null) {
    return;
  }
  int width=canvas.getWidth();
  int height=canvas.getHeight();
  paint.setColor(resultBitmap != null ? resultColor : maskColor);
  canvas.drawRect(0,0,width,frame.top,paint);
  canvas.drawRect(0,frame.top,frame.left,frame.bottom + 1,paint);
  canvas.drawRect(frame.right + 1,frame.top,width,frame.bottom + 1,paint);
  canvas.drawRect(0,frame.bottom + 1,width,height,paint);
  if (resultBitmap != null) {
    paint.setAlpha(CURRENT_POINT_OPACITY);
    canvas.drawBitmap(resultBitmap,null,frame,paint);
  }
 else {
    paint.setColor(frameColor);
    canvas.drawRect(frame.left,frame.top,frame.right + 1,frame.top + 2,paint);
    canvas.drawRect(frame.left,frame.top + 2,frame.left + 2,frame.bottom - 1,paint);
    canvas.drawRect(frame.right - 1,frame.top,frame.right + 1,frame.bottom - 1,paint);
    canvas.drawRect(frame.left,frame.bottom - 1,frame.right + 1,frame.bottom + 1,paint);
    paint.setColor(laserColor);
    paint.setAlpha(SCANNER_ALPHA[scannerAlpha]);
    scannerAlpha=(scannerAlpha + 1) % SCANNER_ALPHA.length;
    int middle=frame.height() / 2 + frame.top;
    canvas.drawRect(frame.left + 2,middle - 1,frame.right - 1,middle + 2,paint);
    Rect previewFrame=CameraManager.get().getFramingRectInPreview();
    float scaleX=frame.width() / (float)previewFrame.width();
    float scaleY=frame.height() / (float)previewFrame.height();
    List<ResultPoint> currentPossible=possibleResultPoints.get();
    List<ResultPoint> currentLast=lastPossibleResultPoints.get();
    if (currentPossible.isEmpty()) {
      lastPossibleResultPoints.set(null);
    }
 else {
      possibleResultPoints.set(new ArrayList<ResultPoint>(5));
      lastPossibleResultPoints.set(currentPossible);
      paint.setAlpha(CURRENT_POINT_OPACITY);
      paint.setColor(resultPointColor);
      for (      ResultPoint point : currentPossible) {
        canvas.drawCircle(frame.left + (int)(point.getX() * scaleX),frame.top + (int)(point.getY() * scaleY),6.0f,paint);
      }
    }
    if (currentLast != null) {
      paint.setAlpha(CURRENT_POINT_OPACITY / 2);
      paint.setColor(resultPointColor);
      for (      ResultPoint point : currentLast) {
        canvas.drawCircle(frame.left + (int)(point.getX() * scaleX),frame.top + (int)(point.getY() * scaleY),3.0f,paint);
      }
    }
    postInvalidateDelayed(ANIMATION_DELAY,frame.left,frame.top,frame.right,frame.bottom);
  }
}
