{
  String contentType=part.getContentType();
  if (contentType.startsWith("image/")) {
    BufferedImage image=ImageIO.read(part.getInputStream());
    if (image != null) {
      Reader reader=new MultiFormatReader();
      Result result=null;
      try {
        result=reader.decode(new BufferedImageMonochromeBitmapSource(image),DecodeServlet.HINTS);
      }
 catch (      ReaderException re) {
        log.info("Decoding FAILED");
      }
      Message reply=new MimeMessage(session);
      Address sender=message.getFrom()[0];
      reply.setRecipient(Message.RecipientType.TO,sender);
      reply.setFrom(fromAddress);
      if (result == null) {
        reply.setSubject("Decode failed");
        reply.setContent("Sorry, we could not decode that image.","text/plain");
      }
 else {
        String text=result.getText();
        reply.setSubject("Decode succeeded");
        reply.setContent(text,"text/plain");
      }
      log.info("Sending reply");
      Transport.send(reply);
    }
  }
}
