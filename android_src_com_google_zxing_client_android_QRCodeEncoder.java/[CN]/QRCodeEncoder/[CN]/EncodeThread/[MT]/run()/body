{
  try {
    ByteMatrix result=new MultiFormatWriter().encode(mContents,BarcodeFormat.QR_CODE,mPixelResolution,mPixelResolution);
    int width=result.width();
    int height=result.height();
    byte[][] array=result.getArray();
    int[] pixels=new int[width * height];
    for (int y=0; y < height; y++) {
      for (int x=0; x < width; x++) {
        int grey=array[y][x] & 0xff;
        pixels[y * width + x]=0xff000000 | (0x00010101 * grey);
      }
    }
    Bitmap bitmap=Bitmap.createBitmap(width,height,Bitmap.Config.ARGB_8888);
    bitmap.setPixels(pixels,0,width,0,0,width,height);
    Message message=Message.obtain(mHandler,R.id.encode_succeeded);
    message.obj=bitmap;
    message.sendToTarget();
  }
 catch (  WriterException e) {
    Log.e(TAG,e.toString());
    Message message=Message.obtain(mHandler,R.id.encode_failed);
    message.sendToTarget();
  }
catch (  IllegalArgumentException e) {
    Log.e(TAG,e.toString());
    Message message=Message.obtain(mHandler,R.id.encode_failed);
    message.sendToTarget();
  }
}
