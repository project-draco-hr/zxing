{
  for (int y=0; y < height; y++) {
    int offset=y * width;
    int left=luminances[offset] & 0xff;
    int center=luminances[offset + 1] & 0xff;
    for (int x=1; x < width - 1; x++) {
      int right=luminances[offset + x + 1] & 0xff;
      int pixel=((center << 2) - left - right) >> 1;
      if (pixel > 255) {
        pixel=255;
      }
 else       if (pixel < 0) {
        pixel=0;
      }
      luminances[offset + x]=(byte)pixel;
      left=center;
      center=right;
    }
  }
}
