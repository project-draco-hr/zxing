{
  if (numBits < 0 || numBits > 32) {
    throw new IllegalArgumentException("Num bits must be between 0 and 32");
  }
  int numBitsLeft=numBits;
  while (numBitsLeft > 0) {
    if ((sizeInBits & 0x7) == 0 && numBitsLeft >= 8) {
      final int newByte=(value >> (numBitsLeft - 8)) & 0xff;
      appendByte(newByte);
      numBitsLeft-=8;
    }
 else {
      final int bit=(value >> (numBitsLeft - 1)) & 1;
      appendBit(bit);
      --numBitsLeft;
    }
  }
}
