{
  int symbolSizeRows=version.getSymbolSizeRows();
  int symbolSizeColumns=version.getSymbolSizeColumns();
  if (bitMatrix.getDimension() != symbolSizeRows) {
    throw new IllegalArgumentException("Dimension of bitMarix must match the version size");
  }
  int dataRegionSizeRows=version.getDataRegionSizeRows();
  int dataRegionSizeColumns=version.getDataRegionSizeColumns();
  int numDataRegionsRow=symbolSizeRows / dataRegionSizeRows;
  int numDataRegionsColumn=symbolSizeColumns / dataRegionSizeColumns;
  int sizeDataRegionRow=numDataRegionsRow * dataRegionSizeRows;
  BitMatrix bitMatrixWithoutAlignment=new BitMatrix(sizeDataRegionRow);
  for (int dataRegionRow=0; dataRegionRow < numDataRegionsRow; ++dataRegionRow) {
    for (int dataRegionColumn=0; dataRegionColumn < numDataRegionsColumn; ++dataRegionColumn) {
      for (int i=0; i < dataRegionSizeRows; ++i) {
        for (int j=0; j < dataRegionSizeColumns; ++j) {
          int readRowOffset=dataRegionRow * (dataRegionSizeRows + 2) + 1 + i;
          int readColumnOffset=dataRegionColumn * (dataRegionSizeColumns + 2) + 1 + j;
          int writeRowOffset=dataRegionRow * dataRegionSizeRows + i;
          int writeColumnOffset=dataRegionColumn * dataRegionSizeColumns + j;
          if (bitMatrix.get(readRowOffset,readColumnOffset)) {
            bitMatrixWithoutAlignment.set(writeRowOffset,writeColumnOffset);
          }
        }
      }
    }
  }
  return bitMatrixWithoutAlignment;
}
