{
  if (row == null || row.getSize() < getWidth) {
    row=new BitArray(getWidth);
  }
 else {
    row.clear();
  }
  if (lastMethod.equals(BlackPointEstimationMethod.ROW_SAMPLING)) {
    int offset=y * width + startX;
    int left=computeRGBLuminance(rgbPixels[offset]);
    offset++;
    int center=computeRGBLuminance(rgbPixels[offset]);
    for (int i=1; i < getWidth - 1; i++, offset++) {
      int right=computeRGBLuminance(rgbPixels[offset + 1]);
      int luminance=((center << 2) - left - right) >> 1;
      if (luminance < blackPoint) {
        row.set(i);
      }
      left=center;
      center=right;
    }
  }
 else {
    for (int i=0, offset=y * width + startX; i < getWidth; i++, offset++) {
      if (computeRGBLuminance(rgbPixels[offset]) < blackPoint) {
        row.set(i);
      }
    }
  }
  return row;
}
