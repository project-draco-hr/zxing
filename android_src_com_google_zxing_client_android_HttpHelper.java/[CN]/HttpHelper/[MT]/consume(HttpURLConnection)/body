{
  String encoding=getEncoding(connection);
  ByteArrayOutputStream out=new ByteArrayOutputStream();
  InputStream in=connection.getInputStream();
  try {
    in=connection.getInputStream();
    byte[] buffer=new byte[1024];
    int bytesRead;
    while ((bytesRead=in.read(buffer)) > 0) {
      out.write(buffer,0,bytesRead);
    }
  }
  finally {
    try {
      in.close();
    }
 catch (    IOException ioe) {
    }
  }
  try {
    return new String(out.toByteArray(),encoding);
  }
 catch (  UnsupportedEncodingException uee) {
    try {
      return new String(out.toByteArray(),"UTF-8");
    }
 catch (    UnsupportedEncodingException uee2) {
      throw new IllegalStateException(uee2);
    }
  }
}
