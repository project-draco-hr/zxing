{
  Log.i(TAG,"Downloading " + uri);
  URL url=new URL(uri);
  URLConnection conn=url.openConnection();
  if (!(conn instanceof HttpURLConnection)) {
    throw new IOException();
  }
  HttpURLConnection connection=(HttpURLConnection)conn;
  connection.setRequestProperty("Accept",contentTypes);
  connection.setRequestProperty("Accept-Charset","utf-8,*");
  connection.setRequestProperty("User-Agent","ZXing (Android)");
  try {
    try {
      connection.connect();
    }
 catch (    NullPointerException npe) {
      Log.w(TAG,"Bad URI? " + uri);
      throw new IOException(npe);
    }
catch (    IllegalArgumentException iae) {
      Log.w(TAG,"Bad URI? " + uri);
      throw new IOException(iae);
    }
    int responseCode;
    try {
      responseCode=connection.getResponseCode();
    }
 catch (    NullPointerException npe) {
      Log.w(TAG,"Bad URI? " + uri);
      throw new IOException(npe);
    }
    if (responseCode != HttpURLConnection.HTTP_OK) {
      throw new IOException("Bad HTTP response: " + responseCode);
    }
    Log.i(TAG,"Consuming " + uri);
    return consume(connection,maxChars);
  }
  finally {
    connection.disconnect();
  }
}
