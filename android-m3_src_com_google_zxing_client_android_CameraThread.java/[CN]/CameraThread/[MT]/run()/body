{
  Looper.prepare();
  handler=new Handler(){
    public void handleMessage(    Message message){
switch (message.what) {
case R.id.preview:
        if (!suspendPreview) {
          surfaceView.capturePreviewAndDraw();
        }
      break;
case R.id.save:
    suspendPreview=true;
  Message save=Message.obtain(decodeThread.handler,R.id.save);
save.sendToTarget();
break;
case R.id.restart_preview:
restartPreviewAndDecode();
return;
case R.id.quit:
Message quit=Message.obtain(decodeThread.handler,R.id.quit);
quit.sendToTarget();
Looper.myLooper().quit();
break;
case R.id.decode_started:
suspendPreview=false;
break;
case R.id.decode_succeeded:
Message success=Message.obtain(activityHandler,R.id.decode_succeeded,message.obj);
success.arg1=message.arg1;
success.sendToTarget();
suspendPreview=true;
break;
case R.id.decode_failed:
requestDecode=true;
break;
case R.id.save_succeeded:
restartPreviewAndDecode();
break;
case R.id.save_failed:
restartPreviewAndDecode();
return;
}
if (requestDecode) {
requestDecode=false;
suspendPreview=true;
Message decode=Message.obtain(decodeThread.handler,R.id.decode);
decode.sendToTarget();
}
 else if (!suspendPreview) {
Message preview=Message.obtain(handler,R.id.preview);
preview.sendToTarget();
}
}
}
;
decodeThread.setCameraThreadHandler(handler);
Message preview=Message.obtain(handler,R.id.preview);
preview.sendToTarget();
Looper.loop();
}
