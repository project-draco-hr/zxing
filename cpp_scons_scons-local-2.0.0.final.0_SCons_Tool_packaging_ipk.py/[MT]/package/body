def package(env, target, source, PACKAGEROOT, NAME, VERSION, DESCRIPTION, SUMMARY, X_IPK_PRIORITY, X_IPK_SECTION, SOURCE_URL, X_IPK_MAINTAINER, X_IPK_DEPENDS, **kw):
    ' this function prepares the packageroot directory for packaging with the\n    ipkg builder.\n    '
    SCons.Tool.Tool('ipkg').generate(env)
    bld = env['BUILDERS']['Ipkg']
    (target, source) = stripinstallbuilder(target, source, env)
    (target, source) = putintopackageroot(target, source, env, PACKAGEROOT)
    archmap = {'i686': 'i386', 'i586': 'i386', 'i486': 'i386', }
    buildarchitecture = os.uname()[4]
    buildarchitecture = archmap.get(buildarchitecture, buildarchitecture)
    if ('ARCHITECTURE' in kw):
        buildarchitecture = kw['ARCHITECTURE']
    loc = locals()
    del loc['kw']
    kw.update(loc)
    del kw['source'], kw['target'], kw['env']
    specfile = gen_ipk_dir(PACKAGEROOT, source, env, kw)
    if (str(target[0]) == ('%s-%s' % (NAME, VERSION))):
        target = [('%s_%s_%s.ipk' % (NAME, VERSION, buildarchitecture))]
    return bld(env, target, specfile, **kw)
