{
  if (when.length() == 8) {
    Date date;
synchronized (DATE_FORMAT) {
      date=DATE_FORMAT.parse(when,new ParsePosition(0));
    }
    if (end && !sameStartEnd) {
      date=new Date(date.getTime() - 24 * 60 * 60* 1000);
    }
    ParsedResult.maybeAppend(DateFormat.getDateInstance().format(date.getTime()),result);
  }
 else {
    Date date;
synchronized (DATE_TIME_FORMAT) {
      date=DATE_TIME_FORMAT.parse(when.substring(0,15),new ParsePosition(0));
    }
    long milliseconds=date.getTime();
    if (when.length() == 16 && when.charAt(15) == 'Z') {
      Calendar calendar=new GregorianCalendar();
      milliseconds+=calendar.get(Calendar.ZONE_OFFSET);
      calendar.setTime(new Date(milliseconds));
      milliseconds+=calendar.get(Calendar.DST_OFFSET);
    }
    ParsedResult.maybeAppend(DateFormat.getDateTimeInstance().format(milliseconds),result);
  }
}
