{
  int borderWidth=0;
  while (!image.isBlack(borderWidth,borderWidth)) {
    borderWidth++;
  }
  int moduleEnd=borderWidth;
  while (image.isBlack(moduleEnd,moduleEnd)) {
    moduleEnd++;
  }
  int moduleSize=moduleEnd - borderWidth;
  int rowEndOfSymbol=image.getWidth() - 1;
  while (!image.isBlack(rowEndOfSymbol,borderWidth)) {
    rowEndOfSymbol--;
  }
  rowEndOfSymbol++;
  if ((rowEndOfSymbol - borderWidth) % moduleSize != 0) {
    throw new ReaderException("Bad module size / width: " + moduleSize + " / "+ (rowEndOfSymbol - borderWidth));
  }
  int dimension=(rowEndOfSymbol - borderWidth) / moduleSize;
  borderWidth+=moduleSize >> 1;
  BitMatrix bits=new BitMatrix(dimension);
  for (int i=0; i < dimension; i++) {
    int iOffset=borderWidth + i * moduleSize;
    for (int j=0; j < dimension; j++) {
      if (image.isBlack(borderWidth + j * moduleSize,iOffset)) {
        bits.set(i,j);
      }
    }
  }
  return bits;
}
