{
  BitMatrixParser parser=new BitMatrixParser(bits);
  Version version=parser.readVersion();
  ErrorCorrectionLevel ecLevel=parser.readFormatInformation().getErrorCorrectionLevel();
  byte[] codewords=parser.readCodewords();
  DataBlock[] dataBlocks=DataBlock.getDataBlocks(codewords,version,ecLevel);
  int totalBytes=0;
  for (int i=0; i < dataBlocks.length; i++) {
    totalBytes+=dataBlocks[i].getNumDataCodewords();
  }
  byte[] resultBytes=new byte[totalBytes];
  int resultOffset=0;
  for (int j=0; j < dataBlocks.length; j++) {
    DataBlock dataBlock=dataBlocks[j];
    byte[] codewordBytes=dataBlock.getCodewords();
    int numDataCodewords=dataBlock.getNumDataCodewords();
    correctErrors(codewordBytes,numDataCodewords);
    for (int i=0; i < numDataCodewords; i++) {
      resultBytes[resultOffset++]=codewordBytes[i];
    }
  }
  String text=DecodedBitStreamParser.decode(resultBytes,version);
  return new DecoderResult(resultBytes,text);
}
