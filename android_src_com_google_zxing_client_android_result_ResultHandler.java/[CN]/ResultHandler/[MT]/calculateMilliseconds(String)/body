{
  if (when.length() == 8) {
    SimpleDateFormat format=new SimpleDateFormat("yyyyMMdd");
    Date date=format.parse(when,new ParsePosition(0));
    return date.getTime();
  }
 else {
    SimpleDateFormat format=new SimpleDateFormat("yyyyMMdd'T'HHmmss");
    Date date=format.parse(when.substring(0,15),new ParsePosition(0));
    long milliseconds=date.getTime();
    if (when.length() == 16 && when.charAt(15) == 'Z') {
      GregorianCalendar calendar=new GregorianCalendar();
      int offset=(calendar.get(java.util.Calendar.ZONE_OFFSET) + calendar.get(java.util.Calendar.DST_OFFSET));
      milliseconds+=offset;
    }
    return milliseconds;
  }
}
