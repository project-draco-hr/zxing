{
  int length=value.length();
  StringBuffer result=new StringBuffer(length);
  ByteArrayOutputStream fragmentBuffer=new ByteArrayOutputStream();
  for (int i=0; i < length; i++) {
    char c=value.charAt(i);
switch (c) {
case '\r':
case '\n':
      break;
case '=':
    if (i < length - 2) {
      char nextChar=value.charAt(i + 1);
      if (nextChar == '\r' || nextChar == '\n') {
      }
 else {
        char nextNextChar=value.charAt(i + 2);
        try {
          int encodedByte=16 * toHexValue(nextChar) + toHexValue(nextNextChar);
          fragmentBuffer.write(encodedByte);
        }
 catch (        IllegalArgumentException iae) {
        }
        i+=2;
      }
    }
  break;
default :
maybeAppendFragment(fragmentBuffer,charset,result);
result.append(c);
}
}
maybeAppendFragment(fragmentBuffer,charset,result);
return result.toString();
}
