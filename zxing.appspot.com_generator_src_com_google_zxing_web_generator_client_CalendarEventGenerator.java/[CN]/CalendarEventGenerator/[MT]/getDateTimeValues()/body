{
  Date date1=datePicker1.getDatePicker().getSelectedDate();
  Date date2=datePicker2.getDatePicker().getSelectedDate();
  Date time1=timePicker1.getDateTime();
  Date time2=timePicker2.getDateTime();
  if (null == date1 || null == date2 || null == time1 || null == time2) {
    throw new GeneratorException("Start and end dates/times must be set.");
  }
  String timezoneDelta=timeZones.getValue(timeZones.getSelectedIndex());
  long diffTimeZone=Long.parseLong(timezoneDelta);
  if (summerTime.isChecked()) {
    diffTimeZone+=ONE_HOUR;
  }
  Date dateTime1=addMilliseconds(mergeDateAndTime(date1,time1),-diffTimeZone);
  Date dateTime2=addMilliseconds(mergeDateAndTime(date2,time2),-diffTimeZone);
  if (dateTime1.after(dateTime2)) {
    throw new GeneratorException("Ending date is after starting date.");
  }
  DateTimeFormat isoFormatter=DateTimeFormat.getFormat("yyyyMMdd'T'HHmmss'Z'");
  StringBuilder output=new StringBuilder();
  output.append("DTSTART:");
  output.append(isoFormatter.format(dateTime1));
  output.append("\r\n");
  output.append("DTEND:");
  output.append(isoFormatter.format(dateTime2));
  output.append("\r\n");
  return output.toString();
}
