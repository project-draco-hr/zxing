{
  final int ecCode=QRCode.getECLevelCode(ecLevel);
  if (!QRCode.isValidMaskPattern(maskPattern)) {
    throw new WriterException("Invalid mask pattern");
  }
  final int typeInfo=(ecCode << 3) | maskPattern;
  bits.appendBits(typeInfo,5);
  final int bchCode=MatrixUtil.calculateBCHCode(typeInfo,TYPE_INFO_POLY);
  bits.appendBits(bchCode,10);
  BitVector maskBits=new BitVector();
  maskBits.appendBits(TYPE_INFO_MASK_PATTERN,15);
  bits.xor(maskBits);
  if (bits.size() != 15) {
    throw new WriterException("should not happen but we got: " + bits.size());
  }
}
