def msvs_setup_env(env):
    batfilename = msvs.get_batch_file()
    msvs = get_vs_by_version(version)
    if (msvs is None):
        return
    if (batfilename is not None):
        vars = ('LIB', 'LIBPATH', 'PATH', 'INCLUDE')
        msvs_list = get_installed_visual_studios()
        vscommonvarnames = [vs.common_tools_var for vs in msvs_list]
        save_ENV = env['ENV']
        nenv = normalize_env(env['ENV'], (['COMSPEC'] + vscommonvarnames), force=True)
        try:
            output = get_output(batfilename, arch, env=nenv)
        finally:
            env['ENV'] = save_ENV
        vars = parse_output(output, vars)
        for (k, v) in vars.items():
            env.PrependENVPath(k, v, delete_existing=1)
