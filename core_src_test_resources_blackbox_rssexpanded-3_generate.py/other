import os
import glob
import sys
import subprocess
import traceback
import hashlib
import urllib
import urllib2
ZINT = 'zint'
ZINT_RSS_EXPANDED_CODE = 31
ZINT_BINARY = 'zint'
POSTSCRIPT = 'postscript'
TEST_FILE = '../../../src/com/google/zxing/oned/rss/RSSExpandedBlackBox3TestCase.java'
GENERATORS = []
if check_zint():
    GENERATORS.append(ZINT)
if check_postscript():
    GENERATORS.append(POSTSCRIPT)
if (__name__ == '__main__'):
    counter = 0
    for image_to_delete in glob.glob('*.png'):
        os.remove(image_to_delete)
    for text_to_delete in glob.glob('*.txt'):
        os.remove(text_to_delete)
    for generator in GENERATORS:
        for (exceptions, barcode) in extract_barcodes():
            if (generator in exceptions):
                continue
            try:
                counter += 1
                image_filename = (str(counter) + '.png')
                text_filename = (str(counter) + '.txt')
                open(text_filename, 'w').write(barcode)
                generate_image(image_filename, barcode, generator)
            except Exception:
                print ('Error with generator %s and barcode %s' % (generator, barcode))
                traceback.print_exc()
                counter -= 1
    open(TEST_FILE, 'w').write(('package com.google.zxing.oned.rss;\n\nimport com.google.zxing.BarcodeFormat;\nimport com.google.zxing.MultiFormatReader;\nimport com.google.zxing.common.AbstractBlackBoxTestCase;\n\npublic class RSSExpandedBlackBox3TestCase extends AbstractBlackBoxTestCase {\n    \n    public RSSExpandedBlackBox3TestCase() {\n        super("test/data/blackbox/rssexpanded-3", new MultiFormatReader(), BarcodeFormat.RSS_EXPANDED);\n        addTest(%(number)s, %(number)s, 0.0f);\n        addTest(%(number)s, %(number)s, 180.0f);\n    }\n}\n    ' % {'number': counter, }))
