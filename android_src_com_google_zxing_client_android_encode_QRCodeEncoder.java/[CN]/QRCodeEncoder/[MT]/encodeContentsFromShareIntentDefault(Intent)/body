{
  format=BarcodeFormat.QR_CODE;
  Bundle bundle=intent.getExtras();
  if (bundle == null) {
    throw new WriterException("No extras");
  }
  Uri uri=(Uri)bundle.getParcelable(Intent.EXTRA_STREAM);
  if (uri == null) {
    throw new WriterException("No EXTRA_STREAM");
  }
  byte[] vcard;
  String vcardString;
  try {
    InputStream stream=activity.getContentResolver().openInputStream(uri);
    int length=stream.available();
    if (length <= 0) {
      throw new WriterException("Content stream is empty");
    }
    vcard=new byte[length];
    int bytesRead=stream.read(vcard,0,length);
    if (bytesRead < length) {
      throw new WriterException("Unable to fully read available bytes from content stream");
    }
    vcardString=new String(vcard,0,bytesRead,"UTF-8");
  }
 catch (  IOException ioe) {
    throw new WriterException(ioe);
  }
  Log.d(TAG,"Encoding share intent content:");
  Log.d(TAG,vcardString);
  Result result=new Result(vcardString,vcard,null,BarcodeFormat.QR_CODE);
  ParsedResult parsedResult=ResultParser.parseResult(result);
  if (!(parsedResult instanceof AddressBookParsedResult)) {
    throw new WriterException("Result was not an address");
  }
  encodeQRCodeContents((AddressBookParsedResult)parsedResult);
  if (contents == null || contents.length() == 0) {
    throw new WriterException("No content to encode");
  }
}
