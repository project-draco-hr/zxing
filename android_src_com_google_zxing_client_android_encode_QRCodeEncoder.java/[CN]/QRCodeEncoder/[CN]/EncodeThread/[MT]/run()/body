{
  try {
    BitMatrix result=new MultiFormatWriter().encode(contents,format,pixelResolution,pixelResolution);
    int width=result.getWidth();
    int height=result.getHeight();
    int[] pixels=new int[width * height];
    for (int y=0; y < height; y++) {
      int offset=y * width;
      for (int x=0; x < width; x++) {
        pixels[offset + x]=result.get(x,y) ? BLACK : WHITE;
      }
    }
    Bitmap bitmap=Bitmap.createBitmap(width,height,Bitmap.Config.ARGB_8888);
    bitmap.setPixels(pixels,0,width,0,0,width,height);
    Message message=Message.obtain(handler,R.id.encode_succeeded);
    message.obj=bitmap;
    message.sendToTarget();
  }
 catch (  WriterException e) {
    Log.e(TAG,e.toString());
    Message message=Message.obtain(handler,R.id.encode_failed);
    message.sendToTarget();
  }
catch (  IllegalArgumentException e) {
    Log.e(TAG,e.toString());
    Message message=Message.obtain(handler,R.id.encode_failed);
    message.sendToTarget();
  }
}
