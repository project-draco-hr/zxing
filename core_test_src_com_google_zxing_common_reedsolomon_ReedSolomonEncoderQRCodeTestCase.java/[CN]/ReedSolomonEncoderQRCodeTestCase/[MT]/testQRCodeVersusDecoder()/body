{
  Random random=getRandom();
  ReedSolomonEncoder encoder=new ReedSolomonEncoder(GenericGF.QR_CODE_FIELD_256);
  ReedSolomonDecoder decoder=new ReedSolomonDecoder(GenericGF.QR_CODE_FIELD_256);
  for (int i=0; i < 100; i++) {
    int size=2 + random.nextInt(254);
    int[] toEncode=new int[size];
    int ecBytes=1 + random.nextInt(2 * (1 + size / 8));
    ecBytes=Math.min(ecBytes,size - 1);
    int dataBytes=size - ecBytes;
    for (int j=0; j < dataBytes; j++) {
      toEncode[j]=random.nextInt(256);
    }
    int[] original=new int[dataBytes];
    System.arraycopy(toEncode,0,original,0,dataBytes);
    encoder.encode(toEncode,ecBytes);
    corrupt(toEncode,ecBytes / 2,random);
    decoder.decode(toEncode,ecBytes);
    assertArraysEqual(original,0,toEncode,0,dataBytes);
  }
}
