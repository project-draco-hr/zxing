{
  this.activity=activity;
  multiFormatReader=new MultiFormatReader();
  Hashtable<DecodeHintType,Object> hints=new Hashtable<DecodeHintType,Object>(3);
  if (decodeFormats == null || decodeFormats.isEmpty()) {
    SharedPreferences prefs=PreferenceManager.getDefaultSharedPreferences(activity);
    boolean decode1D=prefs.getBoolean(PreferencesActivity.KEY_DECODE_1D,true);
    boolean decodeQR=prefs.getBoolean(PreferencesActivity.KEY_DECODE_QR,true);
    if (decode1D && decodeQR) {
      hints.put(DecodeHintType.POSSIBLE_FORMATS,CaptureActivity.ALL_FORMATS);
    }
 else     if (decode1D) {
      hints.put(DecodeHintType.POSSIBLE_FORMATS,CaptureActivity.ONE_D_FORMATS);
    }
 else     if (decodeQR) {
      hints.put(DecodeHintType.POSSIBLE_FORMATS,CaptureActivity.QR_CODE_FORMATS);
    }
  }
 else {
    hints.put(DecodeHintType.POSSIBLE_FORMATS,decodeFormats);
  }
  if (characterSet != null) {
    hints.put(DecodeHintType.CHARACTER_SET,characterSet);
  }
  hints.put(DecodeHintType.NEED_RESULT_POINT_CALLBACK,resultPointCallback);
  multiFormatReader.setHints(hints);
}
