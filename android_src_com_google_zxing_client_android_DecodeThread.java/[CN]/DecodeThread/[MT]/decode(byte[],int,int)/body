{
  long start=System.currentTimeMillis();
  Result rawResult=null;
  PlanarYUVLuminanceSource source=CameraManager.get().buildLuminanceSource(data,width,height);
  BinaryBitmap bitmap=new BinaryBitmap(new GlobalHistogramBinarizer(source));
  try {
    rawResult=multiFormatReader.decodeWithState(bitmap);
  }
 catch (  ReaderException re) {
  }
  if (rawResult != null) {
    long end=System.currentTimeMillis();
    Log.v(TAG,"Found barcode (" + (end - start) + " ms):\n"+ rawResult.toString());
    Message message=Message.obtain(activity.getHandler(),R.id.decode_succeeded,rawResult);
    Bundle bundle=new Bundle();
    bundle.putParcelable(BARCODE_BITMAP,source.renderCroppedGreyscaleBitmap());
    message.setData(bundle);
    message.sendToTarget();
  }
 else {
    Message message=Message.obtain(activity.getHandler(),R.id.decode_failed);
    message.sendToTarget();
  }
}
