{
  WifiConfiguration found=findNetworkInExistingConfig(config.SSID);
  wifiManager.disconnect();
  if (found == null) {
    statusView.setText(R.string.wifi_creating_network);
  }
 else {
    statusView.setText(R.string.wifi_modifying_network);
    Log.d(TAG,"Removing network " + found.networkId);
    wifiManager.removeNetwork(found.networkId);
    wifiManager.saveConfiguration();
  }
  networkId=wifiManager.addNetwork(config);
  Log.d(TAG,"Inserted/Modified network " + networkId);
  if (networkId < 0) {
    return FAILURE_NO_NETWORK_ID;
  }
  if (!wifiManager.enableNetwork(networkId,disableOthers)) {
    networkId=FAILURE_NO_NETWORK_ID;
    return FAILURE_NO_NETWORK_ID;
  }
  errorCount=0;
  wifiManager.reassociate();
  return networkId;
}
