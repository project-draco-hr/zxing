{
  final int FAILURE=-1;
  WifiConfiguration found=findNetworkInExistingConfig(config.SSID);
  wifiManager.disconnect();
  if (found == null) {
    statusView.setText(R.string.wifi_creating_network);
  }
 else {
    statusView.setText(R.string.wifi_modifying_network);
    Log.d(TAG,"Removing network " + found.networkId);
    wifiManager.removeNetwork(found.networkId);
    wifiManager.saveConfiguration();
  }
  networkId=wifiManager.addNetwork(config);
  Log.d(TAG,"Inserted/Modified network " + networkId);
  if (networkId < 0)   return FAILURE;
  if (!wifiManager.enableNetwork(networkId,disableOthers)) {
    networkId=-1;
    return FAILURE;
  }
  errorCount=0;
  wifiManager.reassociate();
  return networkId;
}
