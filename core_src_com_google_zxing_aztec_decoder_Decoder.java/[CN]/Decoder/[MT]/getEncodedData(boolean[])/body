{
  int endIndex=codewordSize * ddata.getNbDatablocks();
  if (endIndex > correctedBits.length) {
    throw FormatException.getFormatInstance();
  }
  int lastTable=UPPER;
  int table=UPPER;
  int startIndex=0;
  int code;
  StringBuilder result=new StringBuilder();
  boolean end=false;
  boolean shift=false;
  boolean switchShift=false;
  while (!end) {
    if (shift) {
      switchShift=true;
    }
 else {
      lastTable=table;
    }
switch (table) {
case BINARY:
      if (endIndex - startIndex < 8) {
        end=true;
        break;
      }
    code=readCode(correctedBits,startIndex,8);
  startIndex+=8;
result.append((char)(code));
break;
default :
int size=5;
if (table == DIGIT) {
size=4;
}
if (endIndex - startIndex < size) {
end=true;
break;
}
code=readCode(correctedBits,startIndex,size);
startIndex+=size;
String str=getCharacter(table,code);
if (!str.startsWith("CTRL_")) {
result.append(str);
}
 else {
table=getTable(str.charAt(5));
if (str.charAt(6) == 'S') {
shift=true;
}
}
break;
}
if (switchShift) {
table=lastTable;
shift=false;
switchShift=false;
}
}
return result.toString();
}
