{
  Camera.Parameters parameters=camera.getParameters();
  if (parameters == null) {
    Log.w(TAG,"Device error: no camera parameters are available. Proceeding without configuration.");
    return;
  }
  SharedPreferences prefs=PreferenceManager.getDefaultSharedPreferences(context);
  initializeTorch(parameters,prefs);
  String focusMode=null;
  if (prefs.getBoolean(PreferencesActivity.KEY_AUTO_FOCUS,true)) {
    if (prefs.getBoolean(PreferencesActivity.KEY_DISABLE_CONTINUOUS_FOCUS,false)) {
      focusMode=findSettableValue(parameters.getSupportedFocusModes(),Camera.Parameters.FOCUS_MODE_AUTO);
    }
 else {
      focusMode=findSettableValue(parameters.getSupportedFocusModes(),"continuous-picture","continuous-video",Camera.Parameters.FOCUS_MODE_AUTO);
    }
  }
  if (focusMode == null) {
    focusMode=findSettableValue(parameters.getSupportedFocusModes(),Camera.Parameters.FOCUS_MODE_MACRO,"edof");
  }
  if (focusMode != null) {
    parameters.setFocusMode(focusMode);
  }
  parameters.setPreviewSize(cameraResolution.x,cameraResolution.y);
  camera.setParameters(parameters);
}
