{
  ResultPoint verticeStart=vertices[offsetVertex];
  ResultPoint verticeEnd=vertices[offsetVertex + 4];
  int endWideBar=startWideBar + lenWideBar;
  float barDiff=verticeEnd.getX() - verticeStart.getX();
  float barStart=verticeStart.getX() + (barDiff * startWideBar) / lenPattern;
  float barEnd=verticeStart.getX() + (barDiff * endWideBar) / lenPattern;
  int x=Math.round((barStart + barEnd) / 2.0f);
  int yStart=Math.round(verticeStart.getY());
  int y=yStart;
  int nextBarX=(int)Math.max(barStart,barEnd) + 1;
  while (nextBarX < matrix.getWidth()) {
    if (!matrix.get(nextBarX - 1,y) && matrix.get(nextBarX,y)) {
      break;
    }
    nextBarX++;
  }
  nextBarX-=x;
  boolean isEnd=false;
  while (!isEnd) {
    if (matrix.get(x,y)) {
      isEnd=!matrix.get(x + nextBarX,y) && !matrix.get(x + nextBarX + 1,y);
      y+=rowStep;
      if (y <= 0 || y >= matrix.getHeight() - 1) {
        isEnd=true;
      }
    }
 else {
      if (x > 0 && matrix.get(x - 1,y)) {
        x--;
      }
 else       if (x < matrix.getWidth() - 1 && matrix.get(x + 1,y)) {
        x++;
      }
 else {
        isEnd=true;
        if (y != yStart) {
          y-=rowStep;
        }
      }
    }
  }
  vertices[offsetVertex + 8]=new ResultPoint(x,y);
}
