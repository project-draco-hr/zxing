{
  super.onResume();
  cameraManager=new CameraManager(getApplication());
  viewfinderView=(ViewfinderView)findViewById(R.id.viewfinder_view);
  viewfinderView.setCameraManager(cameraManager);
  resetStatusView();
  SurfaceView surfaceView=(SurfaceView)findViewById(R.id.preview_view);
  SurfaceHolder surfaceHolder=surfaceView.getHolder();
  if (hasSurface) {
    initCamera(surfaceHolder);
  }
 else {
    surfaceHolder.addCallback(this);
    surfaceHolder.setType(SurfaceHolder.SURFACE_TYPE_PUSH_BUFFERS);
  }
  Intent intent=getIntent();
  String action=intent == null ? null : intent.getAction();
  String dataString=intent == null ? null : intent.getDataString();
  if (intent != null && action != null) {
    if (action.equals(Intents.Scan.ACTION)) {
      source=IntentSource.NATIVE_APP_INTENT;
      decodeFormats=DecodeFormatManager.parseDecodeFormats(intent);
      if (intent.hasExtra(Intents.Scan.WIDTH) && intent.hasExtra(Intents.Scan.HEIGHT)) {
        int width=intent.getIntExtra(Intents.Scan.WIDTH,0);
        int height=intent.getIntExtra(Intents.Scan.HEIGHT,0);
        if (width > 0 && height > 0) {
          cameraManager.setManualFramingRect(width,height);
        }
      }
    }
 else     if (dataString != null && dataString.contains(PRODUCT_SEARCH_URL_PREFIX) && dataString.contains(PRODUCT_SEARCH_URL_SUFFIX)) {
      source=IntentSource.PRODUCT_SEARCH_LINK;
      sourceUrl=dataString;
      decodeFormats=DecodeFormatManager.PRODUCT_FORMATS;
    }
 else     if (dataString != null && dataString.startsWith(ZXING_URL)) {
      source=IntentSource.ZXING_LINK;
      sourceUrl=dataString;
      Uri inputUri=Uri.parse(sourceUrl);
      returnUrlTemplate=inputUri.getQueryParameter(RETURN_URL_PARAM);
      decodeFormats=DecodeFormatManager.parseDecodeFormats(inputUri);
    }
 else {
      source=IntentSource.NONE;
      decodeFormats=null;
    }
    characterSet=intent.getStringExtra(Intents.Scan.CHARACTER_SET);
  }
 else {
    source=IntentSource.NONE;
    decodeFormats=null;
    characterSet=null;
  }
  SharedPreferences prefs=PreferenceManager.getDefaultSharedPreferences(this);
  copyToClipboard=prefs.getBoolean(PreferencesActivity.KEY_COPY_TO_CLIPBOARD,true) && (intent == null || intent.getBooleanExtra(Intents.Scan.SAVE_HISTORY,true));
  beepManager.updatePrefs();
  inactivityTimer.onResume();
}
