def mssdk_setup_env(env):
    debug('sdk.py:mssdk_setup_env()')
    if ('MSSDK_DIR' in env):
        sdk_dir = env['MSSDK_DIR']
        if (sdk_dir is None):
            return
        sdk_dir = env.subst(sdk_dir)
        debug(('sdk.py:mssdk_setup_env: Using MSSDK_DIR:%s' % sdk_dir))
    elif ('MSSDK_VERSION' in env):
        sdk_version = env['MSSDK_VERSION']
        if (sdk_version is None):
            msg = ('SDK version %s is not installed' % repr(mssdk))
            raise SCons.Errors.UserError(msg)
        sdk_version = env.subst(sdk_version)
        mssdk = get_sdk_by_version(sdk_version)
        sdk_dir = mssdk.get_sdk_dir()
        debug(('sdk.py:mssdk_setup_env: Using MSSDK_VERSION:%s' % sdk_dir))
    elif ('MSVS_VERSION' in env):
        msvs_version = env['MSVS_VERSION']
        debug(('sdk.py:mssdk_setup_env:Getting MSVS_VERSION from env:%s' % msvs_version))
        if (msvs_version is None):
            debug('sdk.py:mssdk_setup_env thinks msvs_version is None')
            return
        msvs_version = env.subst(msvs_version)
        import vs
        msvs = vs.get_vs_by_version(msvs_version)
        debug(('sdk.py:mssdk_setup_env:msvs is :%s' % msvs))
        if (not msvs):
            debug(('sdk.py:mssdk_setup_env: no VS version detected, bailingout:%s' % msvs))
            return
        sdk_version = msvs.sdk_version
        debug(('sdk.py:msvs.sdk_version is %s' % sdk_version))
        if (not sdk_version):
            return
        mssdk = get_sdk_by_version(sdk_version)
        if (not mssdk):
            mssdk = get_default_sdk()
            if (not mssdk):
                return
        sdk_dir = mssdk.get_sdk_dir()
        debug(('sdk.py:mssdk_setup_env: Using MSVS_VERSION:%s' % sdk_dir))
    else:
        mssdk = get_default_sdk()
        if (not mssdk):
            return
        sdk_dir = mssdk.get_sdk_dir()
        debug(('sdk.py:mssdk_setup_env: not using any env values. sdk_dir:%s' % sdk_dir))
    set_sdk_by_directory(env, sdk_dir)
