{
  qrCode.setECLevel(ecLevel);
  qrCode.setMode(mode);
  if (!QRCode.isValidECLevel(ecLevel)) {
    throw new WriterException("Invalid EC level: " + ecLevel);
  }
  for (int i=0; i < RS_BLOCK_TABLE.length; ++i) {
    final RSBlockInfo row=RS_BLOCK_TABLE[i];
    final int numBytes=row.numBytes;
    final int numEcBytes=row.blockInfo[ecLevel][0];
    final int numRSBlocks=row.blockInfo[ecLevel][1];
    final int numDataBytes=numBytes - numEcBytes;
    if (numDataBytes >= numInputBytes + 3) {
      qrCode.setVersion(i + 1);
      qrCode.setNumTotalBytes(numBytes);
      qrCode.setNumDataBytes(numDataBytes);
      qrCode.setNumRSBlocks(numRSBlocks);
      qrCode.setNumECBytes(numBytes - numDataBytes);
      qrCode.setMatrixWidth(21 + i * 4);
      return;
    }
  }
  throw new WriterException("Cannot find proper rs block info (input data too big?)");
}
