{
  qr_code.set_ec_level(ec_level);
  qr_code.set_mode(mode);
  if (!QRCode.IsValidECLevel(ec_level)) {
    Debug.LOG_ERROR("Invalid EC level: " + ec_level);
    return false;
  }
  for (int i=0; i < kRSBlockTable.length; ++i) {
    final RSBlockInfo row=kRSBlockTable[i];
    final int num_bytes=row.num_bytes;
    final int num_ec_bytes=row.block_info[ec_level][0];
    final int num_rs_blocks=row.block_info[ec_level][1];
    final int num_data_bytes=num_bytes - num_ec_bytes;
    if (num_data_bytes >= num_input_bytes + 3) {
      qr_code.set_version(i + 1);
      qr_code.set_num_total_bytes(num_bytes);
      qr_code.set_num_data_bytes(num_data_bytes);
      qr_code.set_num_rs_blocks(num_rs_blocks);
      qr_code.set_num_ec_bytes(num_bytes - num_data_bytes);
      qr_code.set_matrix_width(21 + i * 4);
      return true;
    }
  }
  Debug.LOG_ERROR("Cannot find proper rs block info (input data too big?)");
  return false;
}
