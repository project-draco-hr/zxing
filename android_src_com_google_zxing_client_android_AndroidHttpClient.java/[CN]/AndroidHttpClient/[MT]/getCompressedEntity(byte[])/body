{
  AbstractHttpEntity entity;
  if (data.length < getMinGzipSize()) {
    entity=new ByteArrayEntity(data);
  }
 else {
    ByteArrayOutputStream arr=new ByteArrayOutputStream();
    OutputStream zipper=new GZIPOutputStream(arr);
    try {
      zipper.write(data);
    }
  finally {
      zipper.close();
    }
    entity=new ByteArrayEntity(arr.toByteArray());
    entity.setContentEncoding("gzip");
  }
  return entity;
}
