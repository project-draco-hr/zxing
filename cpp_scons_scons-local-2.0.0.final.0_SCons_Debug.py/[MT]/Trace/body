def Trace(msg, file=None, mode='w', tstamp=None):
    'Write a trace message to a file.  Whenever a file is specified,\n    it becomes the default for the next call to Trace().'
    global TraceDefault
    global TimeStampDefault
    global PreviousTime
    if (file is None):
        file = TraceDefault
    else:
        TraceDefault = file
    if (tstamp is None):
        tstamp = TimeStampDefault
    else:
        TimeStampDefault = tstamp
    try:
        fp = TraceFP[file]
    except KeyError:
        try:
            fp = TraceFP[file] = open(file, mode)
        except TypeError:
            fp = file
    if tstamp:
        now = time.time()
        fp.write(('%8.4f %8.4f:  ' % ((now - StartTime), (now - PreviousTime))))
        PreviousTime = now
    fp.write(msg)
    fp.flush()
