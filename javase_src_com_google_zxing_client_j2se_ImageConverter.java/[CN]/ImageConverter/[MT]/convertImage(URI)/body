{
  BufferedImage image=ImageIO.read(uri.toURL());
  LuminanceSource source=new BufferedImageLuminanceSource(image);
  BinaryBitmap bitmap=new BinaryBitmap(new HybridBinarizer(source));
  int width=bitmap.getWidth();
  int height=bitmap.getHeight();
  BufferedImage result=new BufferedImage(width,height,BufferedImage.TYPE_INT_ARGB);
  BitArray array=new BitArray(width);
  if (rowSampling) {
    for (int y=0; y < height; y++) {
      try {
        array=bitmap.getBlackRow(y,array);
      }
 catch (      NotFoundException nfe) {
        for (int x=0; x < width; x++) {
          result.setRGB(x,y,RED);
        }
        continue;
      }
      for (int x=0; x < width; x++) {
        result.setRGB(x,y,array.get(x) ? BLACK : WHITE);
      }
    }
  }
 else {
    try {
      BitMatrix matrix=bitmap.getBlackMatrix();
      for (int y=0; y < height; y++) {
        for (int x=0; x < width; x++) {
          result.setRGB(x,y,matrix.get(x,y) ? BLACK : WHITE);
        }
      }
    }
 catch (    NotFoundException nfe) {
    }
  }
  File output=getOutput(uri);
  System.out.printf("Writing output to %s\n",output);
  ImageIO.write(result,FORMAT,output);
}
