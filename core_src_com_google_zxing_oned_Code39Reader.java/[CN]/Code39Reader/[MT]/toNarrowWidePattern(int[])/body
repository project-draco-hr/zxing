{
  int numCounters=counters.length;
  int maxNarrowCounter=0;
  int wideCounters;
  do {
    int minCounter=Integer.MAX_VALUE;
    for (int i=0; i < numCounters; i++) {
      int counter=counters[i];
      if (counter < minCounter && counter > maxNarrowCounter) {
        minCounter=counter;
      }
    }
    maxNarrowCounter=minCounter;
    wideCounters=0;
    int totalWideCountersWidth=0;
    int pattern=0;
    for (int i=0; i < numCounters; i++) {
      int counter=counters[i];
      if (counters[i] > maxNarrowCounter) {
        pattern|=1 << (numCounters - 1 - i);
        wideCounters++;
        totalWideCountersWidth+=counter;
      }
    }
    if (wideCounters == 3) {
      for (int i=0; i < numCounters && wideCounters > 0; i++) {
        int counter=counters[i];
        if (counters[i] > maxNarrowCounter) {
          wideCounters--;
          if ((counter << 1) >= totalWideCountersWidth) {
            throw ReaderException.getInstance();
          }
        }
      }
      return pattern;
    }
  }
 while (wideCounters > 3);
  throw ReaderException.getInstance();
}
