{
  if (!isValidVersion(version)) {
    throw new IllegalArgumentException("Invalid version: " + version);
  }
  if (!isValidMode(mode)) {
    throw new IllegalArgumentException("Invalid mode: " + mode);
  }
  if (version >= 1 && version <= 9) {
    return NUM_BITS_TABLE[0][mode];
  }
 else   if (version >= 10 && version <= 26) {
    return NUM_BITS_TABLE[1][mode];
  }
 else   if (version >= 27 && version <= 40) {
    return NUM_BITS_TABLE[2][mode];
  }
  throw new IllegalArgumentException("Bad version: " + version);
}
