{
  if (y < 0 || y >= getHeight()) {
    throw new IllegalArgumentException("Requested row is outside the image: " + y);
  }
  int width=getWidth();
  if (row == null || row.length < width) {
    row=new byte[width];
  }
  int offset=y * width;
  for (int x=0; x < width; x++) {
    int pixel=pixels[offset + x];
    int luminance=(((pixel & 0x00FF0000) >> 16) + ((pixel & 0x0000FF00) >> 7) + (pixel & 0x000000FF)) >> 2;
    row[x]=(byte)luminance;
  }
  return row;
}
