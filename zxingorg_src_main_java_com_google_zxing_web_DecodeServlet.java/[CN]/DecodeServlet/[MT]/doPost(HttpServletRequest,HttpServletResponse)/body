{
  Collection<Part> parts=request.getParts();
  if (parts.isEmpty()) {
    log.info("File upload was not multipart");
    response.sendRedirect("badimage.jspx");
    return;
  }
  for (  Part part : parts) {
    log.info("Decoding uploaded file");
    try (InputStream is=part.getInputStream()){
      processStream(is,request,response);
    }
   }
}
