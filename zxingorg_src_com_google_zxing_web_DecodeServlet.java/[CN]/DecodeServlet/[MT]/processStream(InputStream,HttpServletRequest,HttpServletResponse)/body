{
  BufferedImage image=ImageIO.read(is);
  if (image == null) {
    response.sendRedirect("badimage.jspx");
    return;
  }
  Reader reader=new MultiFormatReader();
  Result result;
  try {
    result=reader.decode(new BufferedImageMonochromeBitmapSource(image),HINTS);
  }
 catch (  ReaderException re) {
    log.info("DECODE FAILED: " + re.toString());
    response.sendRedirect("notfound.jspx");
    return;
  }
  if (request.getParameter("full") == null) {
    response.setContentType("text/plain");
    response.setCharacterEncoding("UTF8");
    Writer out=new OutputStreamWriter(response.getOutputStream(),"UTF8");
    try {
      out.write(result.getText());
    }
  finally {
      out.close();
    }
  }
 else {
    request.setAttribute("result",result);
    byte[] rawBytes=result.getRawBytes();
    if (rawBytes != null) {
      request.setAttribute("rawBytesString",Arrays.toString(rawBytes));
    }
 else {
      request.setAttribute("rawBytesString","(Not applicable)");
    }
    ParsedResult parsedResult=ResultParser.parseReaderResult(result);
    request.setAttribute("parsedResult",parsedResult);
    request.getRequestDispatcher("decoderesult.jspx").forward(request,response);
  }
}
