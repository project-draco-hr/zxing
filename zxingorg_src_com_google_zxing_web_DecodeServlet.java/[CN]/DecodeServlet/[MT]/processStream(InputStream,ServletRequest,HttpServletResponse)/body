{
  BufferedImage image=ImageIO.read(is);
  if (image == null) {
    response.sendRedirect("badimage.jspx");
    return;
  }
  Reader reader=new MultiFormatReader();
  LuminanceSource source=new BufferedImageLuminanceSource(image);
  BinaryBitmap bitmap=new BinaryBitmap(new GlobalHistogramBinarizer(source));
  Result result=null;
  ReaderException savedException=null;
  try {
    result=reader.decode(bitmap,HINTS_PURE);
  }
 catch (  ReaderException re) {
    savedException=re;
  }
  if (result == null) {
    try {
      result=reader.decode(bitmap,HINTS);
    }
 catch (    ReaderException re) {
      savedException=re;
    }
  }
  if (result == null) {
    try {
      BinaryBitmap hybridBitmap=new BinaryBitmap(new HybridBinarizer(source));
      result=reader.decode(hybridBitmap,HINTS);
    }
 catch (    ReaderException re) {
      savedException=re;
    }
  }
  if (result == null) {
    handleException(savedException,response);
    return;
  }
  if (request.getParameter("full") == null) {
    response.setContentType("text/plain");
    response.setCharacterEncoding("UTF8");
    Writer out=new OutputStreamWriter(response.getOutputStream(),"UTF8");
    try {
      out.write(result.getText());
    }
  finally {
      out.close();
    }
  }
 else {
    request.setAttribute("result",result);
    byte[] rawBytes=result.getRawBytes();
    if (rawBytes != null) {
      request.setAttribute("rawBytesString",arrayToString(rawBytes));
    }
 else {
      request.setAttribute("rawBytesString","(Not applicable)");
    }
    String text=result.getText();
    if (text != null) {
      request.setAttribute("text",StringEscapeUtils.escapeXml(text));
    }
 else {
      request.setAttribute("text","(Not applicable)");
    }
    ParsedResult parsedResult=ResultParser.parseResult(result);
    request.setAttribute("parsedResult",parsedResult);
    String displayResult=parsedResult.getDisplayResult();
    if (displayResult != null) {
      request.setAttribute("displayResult",StringEscapeUtils.escapeXml(displayResult));
    }
 else {
      request.setAttribute("displayResult","(Not applicable)");
    }
    request.getRequestDispatcher("decoderesult.jspx").forward(request,response);
  }
}
