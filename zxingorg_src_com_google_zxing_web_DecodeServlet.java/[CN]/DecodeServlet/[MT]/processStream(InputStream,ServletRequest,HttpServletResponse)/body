{
  BufferedImage image;
  try {
    image=ImageIO.read(is);
  }
 catch (  IOException ioe) {
    log.info(ioe.toString());
    response.sendRedirect("badimage.jspx");
    return;
  }
catch (  CMMException cmme) {
    log.info(cmme.toString());
    response.sendRedirect("badimage.jspx");
    return;
  }
catch (  IllegalArgumentException iae) {
    log.info(iae.toString());
    response.sendRedirect("badimage.jspx");
    return;
  }
  if (image == null) {
    response.sendRedirect("badimage.jspx");
    return;
  }
  if (image.getHeight() <= 1 || image.getWidth() <= 1 || image.getHeight() * image.getWidth() > MAX_PIXELS) {
    log.info("Dimensions too large: " + image.getWidth() + 'x'+ image.getHeight());
    response.sendRedirect("badimage.jspx");
    return;
  }
  processImage(image,request,response);
}
