{
  String imageURIString=request.getParameter("u");
  if (imageURIString == null || imageURIString.length() == 0) {
    response.sendRedirect("badurl.jspx");
    return;
  }
  if (!(imageURIString.startsWith("http://") || imageURIString.startsWith("https://"))) {
    imageURIString="http://" + imageURIString;
  }
  URI imageURI;
  try {
    imageURI=new URI(imageURIString);
  }
 catch (  URISyntaxException urise) {
    response.sendRedirect("badurl.jspx");
    return;
  }
  HttpGet getRequest=new HttpGet(imageURI);
  getRequest.addHeader("Connection","close");
  try {
    HttpResponse getResponse=client.execute(getRequest);
    if (getResponse.getStatusLine().getStatusCode() != HttpServletResponse.SC_OK) {
      response.sendRedirect("badurl.jspx");
      return;
    }
    if (!isSizeOK(getResponse)) {
      response.sendRedirect("badimage.jspx");
      return;
    }
    log.info("Decoding " + imageURI);
    InputStream is=getResponse.getEntity().getContent();
    try {
      processStream(is,request,response);
    }
  finally {
      is.close();
    }
  }
 catch (  IllegalArgumentException iae) {
    getRequest.abort();
    response.sendRedirect("badurl.jspx");
  }
catch (  SocketException se) {
    getRequest.abort();
    response.sendRedirect("badurl.jspx");
  }
catch (  HttpException he) {
    getRequest.abort();
    response.sendRedirect("badurl.jspx");
  }
catch (  UnknownHostException uhe) {
    getRequest.abort();
    response.sendRedirect("badurl.jspx");
  }
}
